webpackJsonp([10],{"EM8+":function(e,t,i){var n=i("NiBA");"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);i("8bSs")("16d0986a",n,!0)},NiBA:function(e,t,i){(e.exports=i("BkJT")(!1)).push([e.i,"\n.header .el-input[data-v-70661e00] {\n  width: 20%;\n}\n.pagination[data-v-70661e00] {\n  text-align: right;\n  margin-top: 2rem;\n}\n",""])},tiUO:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("3cXf"),a=i.n(n),d=i("Y8t/"),r=i("YrpF"),o=i("5VXh"),s=(i("2sCs"),i("ceg5"),i("fYdz"),i("+AKB"),{components:{list:r.a},data:function(){return{listLoading:!0,topBar:[{name:"新增",class:"",type:"success",keys:[],fun:this.newRole},{name:"搜索",key:"name",searchTipCon:"请输入搜索内容"}],canSelect:!0,indexBar:{name:"序号",key:"auto",width:"60"},thead:[{name:"角色名称",key:"name",width:""}],update:0,data:[{id:1,role:"街道管理员",date_time:1533195311304},{id:2,role:"社区管理员",date_time:1533195382959},{id:3,role:"办公职员",date_time:1533195391971}],actionBar:[{name:"编辑",fun:this.edit,type:"success"},{name:"删除",fun:this.delete,type:"danger"}],showDialog:!1,dialogTitle:"",dialogType:"",addForm:{name:"",is_bigdata:"无"},rules:{name:[{required:!0,message:"请输入角色名称",trigger:"blur"},{min:2,max:30,message:"长度在 2 到 30 个字符",trigger:"blur"}]},all_menu_ids:[],defaultProps:{children:"children",label:"name"},defaultTreeChecked:[]}},created:function(){},activated:function(){this.getList(this.urls.role)},methods:{newRole:function(e,t){this.showDialog=!0,this.dialogTitle="新增角色",this.dialogType="new",this.initForm()},edit:function(e,t){var i=this;this.showDialog=!0,this.dialogTitle="编辑角色",this.dialogType="edit",this.addForm.name=t.name,this.addForm.id=t.id,this.defaultTreeChecked=this.getCheckedIds(t.menu_ids,this.all_menu_ids),this.$nextTick(function(){i.$refs.TREE.setCheckedKeys(i.getCheckedIds(t.menu_ids,i.all_menu_ids))})},delete:function(e,t){var i=this;o.MessageBox.confirm("您确定删除此角色吗？","删除角色",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){i.sendData(i.urls.role+"/"+t.id,"","delete",function(e){0==e.code&&(Object(o.Message)({message:"删除成功！！！",duration:1500}),i.update++)})})},resetAddForm:function(e,t){this.showDialog=!1,this.initForm()},initForm:function(){this.addForm.name="",this.addForm.id="",this.defaultTreeChecked.length=0,this.$refs.TREE.setCheckedKeys([])},submitAddForm:function(e,t){var i=this,n=this,d={},r=[],s="get",l=this.urls.role,c=JSON.parse(a()(this.all_menu_ids)),u=n.$refs.TREE.getCheckedNodes();console.log("初始的数据：：：："," menus::",r),c.forEach(function(e,t){e.children&&e.children.length>0?((d=JSON.parse(a()(e))).children=[],u.forEach(function(t,i){t.pid==e.id&&e.children.forEach(function(e,i){e.name==t.name&&d.children.push(e)})}),d.children.length>0&&r.push(d)):u.forEach(function(t,i){0==t.pid&&t.id==e.id&&r.push(t)})}),this.$refs[e].validate(function(e){if(!e)return!1;n.addForm.name.trim()&&r.length>0?("new"==t?s="post":"edit"==t&&(s="put",l=i.urls.role+"/"+n.addForm.id),n.sendData(l,{name:n.addForm.name,menu_ids:r},s,function(e){console.log("res:::",e),0==e.code&&(Object(o.Message)({message:"new"==t?"新增成功！！！":"修改成功！！！",type:"success",duration:1500}),n.showDialog=!1,n.initForm(),n.update++)})):Object(o.Message)({message:"请勾选管理菜单！！！",type:"error",duration:1500})})},getCheckedIds:function(e,t){var i=[],n=e,a="";return Array.isArray(t)&&t.length>0&&Array.isArray(n)&&n.length>0?n.forEach(function(e,n){t.forEach(function(t,n){t.id==e.id&&(e.children&&e.children.length>0?(a=t.children,e.children.forEach(function(e,t){a.forEach(function(t,n){t.id==e.id&&i.push(e.id)})})):i.push(e.id))})}):i=[],i},getList:function(e){var t=this;d.a.get(e).then(function(e){console.log("res:::",e),0==e.code&&(t.all_menu_ids=e.data.all_menu_ids)})},sendData:function(e,t,i,n){d.a.http(e,t,i).then(function(e){"function"==typeof n&&n(e)})}}}),l={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"app-container"},[i("list",{attrs:{url:e.URL+"/role",update:e.update,topBar:e.topBar,canSelect:e.canSelect,indexBar:e.indexBar,thead:e.thead,actionBar:e.actionBar}}),e._v(" "),i("el-dialog",{attrs:{title:e.dialogTitle,dialogType:e.dialogType,visible:e.showDialog,center:""},on:{"update:visible":function(t){e.showDialog=t}}},[i("el-form",{ref:"addForm",staticClass:"demo-ruleForm",attrs:{model:e.addForm,rules:e.rules,"label-width":"100px"}},[i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:16}},[i("el-form-item",{attrs:{label:"角色名称",prop:"name"}},[i("el-input",{attrs:{placeholder:"请输入角色名称"},model:{value:e.addForm.name,callback:function(t){e.$set(e.addForm,"name",t)},expression:"addForm.name"}})],1)],1)],1),e._v(" "),i("el-form-item",{ref:"FORM",attrs:{label:"所管理菜单"}},[i("el-tree",{ref:"TREE",attrs:{data:e.all_menu_ids,"show-checkbox":"","default-expand-all":!1,"default-checked-keys":e.defaultTreeChecked,"node-key":"id","highlight-current":"",props:e.defaultProps}})],1),e._v(" "),i("el-form-item",[i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submitAddForm("addForm",e.dialogType)}}},[e._v("确定")]),e._v(" "),i("el-button",{on:{click:function(t){e.resetAddForm("addForm")}}},[e._v("取消")])],1)],1)],1)],1)},staticRenderFns:[]};var c=i("vSla")(s,l,!1,function(e){i("EM8+")},"data-v-70661e00",null);t.default=c.exports}});