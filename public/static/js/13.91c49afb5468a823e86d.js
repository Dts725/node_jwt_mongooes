webpackJsonp([13],{"5Bw5":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n("ocgh"),i=(n("ceg5"),n("fYdz"),n("+AKB"),{data:function(){return{list:null,listLoading:!0,searchKey:"",res:"",current_page:"",dialogShow:!1,dialogData:{},community_id:"",username:"",FileOut:{title:"业务管理列表",FileOutShow:!1,lists:[],community_id:"",communityList:[],url:"",urlField:"/field",urlTeam:"/team",FieldList:[],TeamList:[],TypeList:[{id:1,value:"人脸"},{id:2,value:"身份证"},{id:3,value:"其他"}],FieldSelected:"",TeamSelected:"",typeSelected:"",start_day:"",end_day:""}}},created:function(){this.pageStart()},activated:function(){this.pageStart()},methods:{pageStart:function(){var t=this;this.storage.getStorage("uinfo").length>1?(this.community_id=JSON.parse(this.storage.getStorage("uinfo")).community_id,this.username=JSON.parse(this.storage.getStorage("uinfo")).username):this.community_id=-1,this.fetchData(),this.getLists(this.FileOut.urlField+"?community_id="+(this.community_id?this.community_id:""),"","get",function(e){t.FileOut.FieldList=e.data}),this.getLists(this.FileOut.urlTeam+"?community_id="+(this.community_id?this.community_id:""),"","get",function(e){t.FileOut.TeamList=e.data}),"admin"==this.username&&this.getLists("/community?community_id="+(this.community_id?this.community_id:""),"","get",function(e){t.FileOut.communityList=e.data})},editCon:function(t){this.dialogShow=!0,this.dialogData=t},saveContent:function(){var t=this;Object(a.e)("/record/"+this.dialogData.id,{content:this.dialogData.content}).then(function(e){if(0==e.code){var n=t.$createElement;t.dialogShow=!1,t.$message({message:n("p",null,[n("i",{style:"color: teal"},"编辑成功！")])})}})},cancelContent:function(){this.dialogShow=!1,this.fetchData()},fetchData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.listLoading=!0;var i="admin"==this.username?"/record?page="+n+"&username="+encodeURI(e):"/record?community_id="+this.community_id+"&page="+n+"&username="+encodeURI(e);Object(a.c)(i).then(function(e){t.res=e.data,t.list=e.data.data,t.listLoading=!1})},desingManager:function(t,e){var n=this;Object(a.a)(e.id).then(function(t){0===t.code&&Object(a.d)({id:t.data.id},2).then(function(){n.fetchData(n.searchKey,n.current_page)})})},cancelManager:function(t,e){var n=this;Object(a.a)(e.id).then(function(t){0===t.code&&Object(a.d)(t.data,1).then(function(){n.fetchData(n.searchKey,n.current_page)})})},handleCurrentChange:function(t){console.log(t),this.current_page=t,this.fetchData(this.searchKey,t)},_searchKey:function(){this.$refs.pagination.internalCurrentPage=1,this.current_page=1,this.fetchData(this.searchKey)},filterType:function(t){var e="";return 1==t?e="人脸":2==t?e="身份证":3==t&&(e="其他"),e},filterTime:function(t){return t?(t=10==String(t).length?1e3*Number(t):Number(t),new Date(t).toLocaleDateString().replace(/\//g,"-")+" "+new Date(t).getHours()+":"+new Date(t).getMinutes()+":"+new Date(t).getSeconds()):""},_fileOut:function(t){var e,n=this,a="<tr><td>时间</td><td>姓名</td><td>身份证号</td><td>手机号</td><td>识别方式</td><td>内容</td></tr>";this.FileOut.lists.forEach(function(t){t.username&&(a+="<tr><td>"+n.dateformat.format(new Date(Number(t.date_time)))+"</td><td>"+t.username+"</td><td>"+t.card+"</td><td>"+t.phone+"</td><td>"+(1==t.type?"人脸":2==t.type?"身份证":"其他")+"</td><td>"+(t.content?t.content:"")+"</td></tr>")}),e="<table>"+a+"</table>",this.ExcelExportByJS.export({title:this.FileOut.title,data:e})},_conditonChanged:function(t,e){var n=this;console.log(t,e);var a=this.FileOut.FieldSelected?"&field_id="+this.FileOut.FieldSelected:"",i=this.FileOut.TeamSelected?"&team_id="+this.FileOut.TeamSelected:"",l=this.FileOut.typeSelected?"&type="+this.FileOut.typeSelected:"",o=this.FileOut.start_day&&0!==this.FileOut.start_day?"&start_day="+this.FileOut.start_day:"",s=this.FileOut.end_day&&0!==this.FileOut.end_day?"&end_day="+this.FileOut.end_day:"",r=this.FileOut.community_id?"&community_id="+this.FileOut.community_id:"&community_id= ";switch(0==t&&(this.FileOut[e]=""),e){case"community_id":r=0==t?"&community_id= ":"&community_id="+t;break;case"FieldSelected":a=0==t?"":"&field_id="+t;break;case"TeamSelected":i=0==t?"":"&team_id="+t;break;case"typeSelected":l=0==t?"":"&type="+t;break;case"start_day":o="&start_day="+this.dateformat.format(new Date(t),"yyyy-MM-dd"),this.FileOut[e]=this.dateformat.format(new Date(t),"yyyy-MM-dd");break;case"end_day":s="&end_day="+this.dateformat.format(new Date(t),"yyyy-MM-dd"),this.FileOut[e]=this.dateformat.format(new Date(t),"yyyy-MM-dd")}this.getLists("/record?"+o+s+a+i+l+r,"","get",function(t){n.FileOut.lists=t.data.data})},getLists:function(t,e,n,a){this.http(t,e,n).then(function(t){a(t)})}}}),l={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"app-container"},[n("el-header",{staticClass:"header"},[n("el-input",{attrs:{placeholder:"请输入内容(名字)"},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}}),t._v(" "),n("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-search"},on:{click:function(e){t._searchKey()}}},[t._v("搜索")]),t._v(" "),n("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){t.searchKey="",t._searchKey()}}},[t._v("取消")]),t._v(" "),n("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){t.FileOut.FileOutShow=!0}}},[t._v("筛选 -> 下载")])],1),t._v(" "),n("el-table",{directives:[{name:"loading",rawName:"v-loading.body",value:t.listLoading,expression:"listLoading",modifiers:{body:!0}}],attrs:{id:"fileExport",data:t.list,"element-loading-text":"Loading",border:"",fit:"","highlight-current-row":""}},[n("el-table-column",{attrs:{label:"时间",align:"center",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(t.filterTime(e.row.date_time))+"\n      ")]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"姓名",align:"center",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(e.row.username)+"\n      ")]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"身份证号",align:"center",width:"auto"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(e.row.card)+"\n      ")]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"手机号",align:"center",width:"auto"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(e.row.phone)+"\n      ")]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"识别方式",align:"center",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(t.filterType(e.row.type))+"\n      ")]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"内容",align:"center",width:"auto"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(e.row.content)+"\n      ")]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"操作",align:"center",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(n){t.editCon(e.row)}}},[t._v("编辑")])]}}])})],1),t._v(" "),n("el-pagination",{ref:"pagination",staticClass:"pagination",attrs:{background:"",layout:"prev, pager, next","page-size":this.res.per_page,total:this.res.total},on:{"current-change":t.handleCurrentChange}}),t._v(" "),n("el-dialog",{attrs:{"close-on-click-modal":!0,title:"编辑",visible:t.dialogShow,center:""},on:{"update:visible":function(e){t.dialogShow=e},close:t.cancelContent}},[n("ul",{staticClass:"record"},[n("li",[n("strong",[t._v("姓名：")]),t._v(" "),n("span",[t._v(t._s(t.dialogData.username))])]),t._v(" "),n("li",[n("strong",[t._v("身份证：")]),t._v(" "),n("span",[t._v(t._s(t.dialogData.card))])]),t._v(" "),n("li",[n("strong",[t._v("手机号：")]),t._v(" "),n("span",[t._v(t._s(t.dialogData.phone))])]),t._v(" "),n("li",[n("strong",[t._v("识别方式：")]),t._v(" "),n("span",[t._v(t._s(t.filterType(t.dialogData.type)))])]),t._v(" "),n("li",[n("strong",[t._v("内容：")]),t._v(" "),n("el-input",{attrs:{placeholder:"请输入办理内容",size:"small",clearable:""},model:{value:t.dialogData.content,callback:function(e){t.$set(t.dialogData,"content",e)},expression:"dialogData.content"}})],1),t._v(" "),n("li",[n("strong",[t._v("时间：")]),t._v(" "),n("span",[t._v(t._s(t.filterTime(t.dialogData.date_time)))])])]),t._v(" "),n("p",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{size:"mini"},on:{click:t.cancelContent}},[t._v("取 消")]),t._v(" "),n("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.saveContent}},[t._v("确 定")])],1)]),t._v(" "),n("el-dialog",{attrs:{"close-on-click-modal":!0,title:t.FileOut.title,visible:t.FileOut.FileOutShow,center:"",width:"80%"},on:{"update:visible":function(e){t.$set(t.FileOut,"FileOutShow",e)}}},[n("el-row",{staticStyle:{"margin-bottom":"1rem",display:"flex","align-items":"center","justify-content":"space-between"}},[n("el-col",{attrs:{span:3}},[n("strong",[t._v("筛选条件：")])]),t._v(" "),n("el-col",{attrs:{span:4}},[n("el-date-picker",{staticStyle:{width:"90%"},attrs:{type:"date",placeholder:"开始日期",editable:!1,format:"yyyy-MM-dd"},on:{change:function(e){t._conditonChanged(t.FileOut.start_day,"start_day")}},model:{value:t.FileOut.start_day,callback:function(e){t.$set(t.FileOut,"start_day",e)},expression:"FileOut.start_day"}})],1),t._v(" "),n("el-col",{attrs:{span:4}},[n("el-date-picker",{staticStyle:{width:"90%"},attrs:{type:"date",placeholder:"结束日期",editable:!1,format:"yyyy-MM-dd"},on:{change:function(e){t._conditonChanged(t.FileOut.end_day,"end_day")}},model:{value:t.FileOut.end_day,callback:function(e){t.$set(t.FileOut,"end_day",e)},expression:"FileOut.end_day"}})],1),t._v(" "),n("el-col",{attrs:{span:5}},[n("el-select",{staticStyle:{width:"90%"},attrs:{placeholder:"识别方式"},on:{change:function(e){t._conditonChanged(t.FileOut.typeSelected,"typeSelected")}},model:{value:t.FileOut.typeSelected,callback:function(e){t.$set(t.FileOut,"typeSelected",e)},expression:"FileOut.typeSelected"}},[n("el-option",{attrs:{label:"全部",value:"0"}}),t._v(" "),t._l(t.FileOut.TypeList,function(t){return n("el-option",{key:t.id,attrs:{label:t.value,value:t.id}})})],2)],1),t._v(" "),n("el-col",{attrs:{span:3}},[n("el-button",{attrs:{type:"success",size:"small"},on:{click:t._fileOut}},[t._v("确定下载")])],1)],1),t._v(" "),n("el-table",{directives:[{name:"loading",rawName:"v-loading.body",value:t.listLoading,expression:"listLoading",modifiers:{body:!0}}],attrs:{id:"fileExport",data:t.FileOut.lists,"element-loading-text":"加载中...",border:"",fit:"","highlight-current-row":""}},[n("el-table-column",{attrs:{label:"时间",align:"center",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n          "+t._s(t.filterTime(e.row.date_time))+"\n        ")]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"姓名",align:"center",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n          "+t._s(e.row.username)+"\n        ")]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"身份证号",align:"center",width:"auto"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n          "+t._s(e.row.card)+"\n        ")]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"手机号",align:"center",width:"auto"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n          "+t._s(e.row.phone)+"\n        ")]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"识别方式",align:"center",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n          "+t._s(t.filterType(e.row.type))+"\n        ")]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"内容",align:"center",width:"auto"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n          "+t._s(e.row.content)+"\n        ")]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"操作",align:"center",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(n){t.editCon(e.row)}}},[t._v("编辑")])]}}])})],1)],1)],1)},staticRenderFns:[]};var o=n("vSla")(i,l,!1,function(t){n("ULRl")},"data-v-498db490",null);e.default=o.exports},"P+Sz":function(t,e,n){(t.exports=n("BkJT")(!1)).push([t.i,"\n.header[data-v-498db490] {\n  padding: 0;\n}\n.header .el-input[data-v-498db490] {\n    width: 20%;\n}\n.pagination[data-v-498db490] {\n  text-align: right;\n  margin-top: 2rem;\n}\n.record[data-v-498db490] {\n  width: 80%;\n  margin: 0 auto;\n  list-style-type: none;\n}\n.record li[data-v-498db490] {\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n    -webkit-box-sizing: border-box;\n            box-sizing: border-box;\n    padding: 0.2rem 0;\n    -webkit-box-align: center;\n        -ms-flex-align: center;\n            align-items: center;\n}\n.record li strong[data-v-498db490] {\n      -webkit-box-flex: 2;\n          -ms-flex: 2;\n              flex: 2;\n      color: #3a8ee6;\n      text-align: right;\n      padding-right: 0.5rem;\n}\n.record li .el-input[data-v-498db490], .record li span[data-v-498db490] {\n      -webkit-box-flex: 9;\n          -ms-flex: 9;\n              flex: 9;\n}\n",""])},ULRl:function(t,e,n){var a=n("P+Sz");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);n("8bSs")("7f78ec95",a,!0)}});